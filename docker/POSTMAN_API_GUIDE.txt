================================================================================
        HÆ¯á»šNG DáºªN TEST API TRÃŠN POSTMAN - LIBRARY AI
================================================================================

ğŸ“Œ TRÆ¯á»šC KHI Báº®T Äáº¦U:

1. API Server Ä‘ang cháº¡y:
   Command: python main.py api
   URL: http://localhost:9999

2. ÄÃ£ cháº¡y index:
   Command: python main.py index
   (Cáº§n cháº¡y Ä‘á»ƒ cÃ³ data search)

3. Test users Ä‘Ã£ tá»“n táº¡i (tá»« test_data.sql):
   - admin@test.com (password: password123)
   - user@test.com (password: password123)
   - member@test.com (password: password123)

================================================================================
                        SETUP POSTMAN
================================================================================

BÆ¯á»šC 1: Táº¡o Environment
------------------------
1. Click "Environments" â†’ "+"
2. Name: Library AI Local
3. Variables:
   - base_url = http://localhost:9999
   - session_id = (leave empty)
4. Save
5. Select environment (top right)

BÆ¯á»šC 2: Táº¡o Collection
-----------------------
1. Click "Collections" â†’ "+"
2. Name: Library AI API
3. Ready to add requests!

================================================================================
                    DANH SÃCH API ENDPOINTS
================================================================================

1. GET  /ai/health                      - Health check
2. POST /ai/search                      - Search books
3. GET  /ai/filters                     - Get filters
4. GET  /ai/recommend/:book_id          - Recommend books
5. POST /ai/chat                        - Chat (start/continue)
6. POST /ai/chat/suggest                - Chat suggestions
7. GET  /ai/chat/history/:session_id    - Get history
8. DELETE /ai/chat/history/:session_id  - Clear history
9. POST /ai/data/sync                   - Trigger sync
10. GET /ai/jobs                        - List jobs
11. GET /ai/jobs/:job_id                - Job status

================================================================================
                    CHI TIáº¾T Tá»ªNG REQUEST
================================================================================

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
1. HEALTH CHECK
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Method: GET
URL: {{base_url}}/ai/health

Headers: (none needed)

Body: (none)

Expected Response:
{
  "status": "success",
  "message": "ok",
  "data": {
    "service": "ai_engine",
    "time": "2026-01-16T...",
    "paths": {...}
  }
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
2. SEARCH BOOKS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Method: POST
URL: {{base_url}}/ai/search

Headers:
Content-Type: application/json

Body (JSON):
{
  "query": "python programming",
  "top_k": 5,
  "filters": {
    "category": "Programming"
  }
}

ğŸ“‹ EXAMPLE QUERIES TO TEST:
---------------------------
Query 1 - Simple search:
{
  "query": "machine learning",
  "top_k": 10
}

Query 2 - With year filter:
{
  "query": "web development",
  "top_k": 5,
  "filters": {
    "published_year": 2020
  }
}

Query 3 - Vietnamese books:
{
  "query": "sÃ¡ch tiáº¿ng viá»‡t",
  "top_k": 5
}

Query 4 - AI books:
{
  "query": "artificial intelligence deep learning",
  "top_k": 8
}

Expected Response:
{
  "status": "success",
  "data": {
    "query": "python programming",
    "top_k": 5,
    "results": [
      {
        "id": "book_001",
        "title": "Python for Beginners",
        "authors": "John Doe",
        "category": "Programming",
        "published_year": 2020,
        "score": 0.95,
        "snippet": "Introduction to Python..."
      }
    ]
  }
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
3. GET FILTERS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Method: GET
URL: {{base_url}}/ai/filters

Headers: (none)
Body: (none)

Expected Response:
{
  "status": "success",
  "data": {
    "categories": ["Programming", "AI", "Web Development"],
    "years": [2023, 2022, 2021],
    "authors": ["John Doe", "Jane Smith"]
  }
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
4. RECOMMEND BOOKS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Method: GET
URL: {{base_url}}/ai/recommend/BOOK_ID?top_k=5

NOTE: Replace BOOK_ID with actual book ID from search results

Example URLs:
{{base_url}}/ai/recommend/book_001?top_k=3
{{base_url}}/ai/recommend/book_123?top_k=5

Headers: (none)
Body: (none)

Expected Response:
{
  "status": "success",
  "data": {
    "book_id": "book_001",
    "recommendations": [
      {
        "id": "book_002",
        "title": "Advanced Python",
        "score": 0.92
      }
    ]
  }
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
5. CHAT - START SESSION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Method: POST
URL: {{base_url}}/ai/chat

Headers:
Content-Type: application/json

Body (JSON):
{
  "message": "TÃ¬m sÃ¡ch vá» Python cho ngÆ°á»i má»›i báº¯t Ä‘áº§u",
  "top_k": 5
}

ğŸ“‹ EXAMPLE CHAT MESSAGES:
-------------------------
Message 1 - Ask for recommendations:
{
  "message": "Gá»£i Ã½ sÃ¡ch há»c láº­p trÃ¬nh cho ngÆ°á»i má»›i",
  "top_k": 5
}

Message 2 - Ask about AI:
{
  "message": "TÃ¬m sÃ¡ch vá» AI vÃ  machine learning",
  "top_k": 8
}

Message 3 - Vietnamese query:
{
  "message": "CÃ³ sÃ¡ch tiáº¿ng Viá»‡t vá» web development khÃ´ng?",
  "top_k": 5
}

Message 4 - Specific topic:
{
  "message": "SÃ¡ch vá» database design vÃ  SQL",
  "top_k": 5
}

âš ï¸ IMPORTANT - AUTO SAVE SESSION ID:
Add this to "Tests" tab in Postman:

if (pm.response.code === 200) {
    const jsonData = pm.response.json();
    if (jsonData.data && jsonData.data.session_id) {
        pm.environment.set("session_id", jsonData.data.session_id);
    }
}

Expected Response:
{
  "status": "success",
  "data": {
    "session_id": "s_abc123def456",
    "answer": "MÃ¬nh tÃ¬m tháº¥y má»™t sá»‘ cuá»‘n liÃªn quan:\n1. ...",
    "sources": [...],
    "history": [...]
  }
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
6. CHAT - CONTINUE SESSION
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Method: POST
URL: {{base_url}}/ai/chat

Headers:
Content-Type: application/json

Body (JSON):
{
  "message": "Trong sá»‘ Ä‘Ã³, cuá»‘n nÃ o dá»… nháº¥t?",
  "session_id": "{{session_id}}",
  "top_k": 3
}

NOTE: Uses {{session_id}} saved from previous chat

ğŸ“‹ FOLLOW-UP MESSAGES:
----------------------
{
  "message": "Cho tÃ´i xem thÃªm sÃ¡ch vá» chá»§ Ä‘á» nÃ y",
  "session_id": "{{session_id}}",
  "top_k": 5
}

{
  "message": "CÃ³ sÃ¡ch nÃ o má»›i hÆ¡n khÃ´ng?",
  "session_id": "{{session_id}}",
  "top_k": 5
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
7. CHAT SUGGESTIONS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Method: POST
URL: {{base_url}}/ai/chat/suggest

Headers:
Content-Type: application/json

Body (JSON):
{
  "context": "",
  "max": 5
}

Alternative body:
{
  "context": "láº­p trÃ¬nh",
  "max": 8
}

Expected Response:
{
  "status": "success",
  "data": {
    "suggestions": [
      "TÃ¬m sÃ¡ch vá» Programming",
      "TÃ¬m sÃ¡ch IT?",
      "SÃ¡ch má»›i nháº¥t?"
    ]
  }
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
8. GET CHAT HISTORY
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Method: GET
URL: {{base_url}}/ai/chat/history/{{session_id}}

Headers: (none)
Body: (none)

Expected Response:
{
  "status": "success",
  "data": {
    "session_id": "s_abc123def456",
    "messages": [
      {
        "role": "user",
        "text": "TÃ¬m sÃ¡ch vá» Python...",
        "time": "2026-01-16T..."
      },
      {
        "role": "assistant",
        "text": "MÃ¬nh tÃ¬m tháº¥y...",
        "time": "2026-01-16T..."
      }
    ]
  }
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
9. CLEAR CHAT HISTORY
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Method: DELETE
URL: {{base_url}}/ai/chat/history/{{session_id}}

Headers: (none)
Body: (none)

Expected Response:
{
  "status": "success",
  "data": {
    "session_id": "s_abc123def456",
    "messages": []
  }
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
10. TRIGGER DATA SYNC
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Method: POST
URL: {{base_url}}/ai/data/sync

Headers:
Content-Type: application/json

Body (JSON) - Index only:
{
  "action": "index"
}

ğŸ“‹ SYNC ACTIONS:
----------------
Action 1 - Re-index ChromaDB:
{
  "action": "index"
}

Action 2 - Re-process data:
{
  "action": "process"
}

Action 3 - Crawl new books:
{
  "action": "crawl"
}

Action 4 - Process + Index:
{
  "action": "all"
}

Expected Response:
{
  "status": "success",
  "message": "ok",
  "data": {
    "job_id": "abc-123-def",
    "action": "index"
  }
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
11. LIST ALL JOBS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Method: GET
URL: {{base_url}}/ai/jobs

Headers: (none)
Body: (none)

Expected Response:
{
  "status": "success",
  "data": {
    "jobs": [
      {
        "id": "abc-123",
        "type": "data_sync:index",
        "status": "completed",
        "created_at": "...",
        "finished_at": "..."
      }
    ]
  }
}

â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”
12. GET JOB STATUS
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

Method: GET
URL: {{base_url}}/ai/jobs/YOUR_JOB_ID

NOTE: Replace YOUR_JOB_ID with job ID from sync response

Example: {{base_url}}/ai/jobs/abc-123-def-456

Headers: (none)
Body: (none)

Expected Response:
{
  "status": "success",
  "data": {
    "id": "abc-123-def",
    "type": "data_sync:index",
    "status": "completed",
    "created_at": "2026-01-16T13:30:00Z",
    "finished_at": "2026-01-16T13:30:15Z",
    "error": null
  }
}

================================================================================
                    WORKFLOW TEST SCENARIOS
================================================================================

ğŸ¯ SCENARIO 1: Basic Search & Discovery
----------------------------------------
1. Health Check          â†’ Verify API running
2. Get Filters           â†’ See available categories
3. Search "python"       â†’ Find Python books
4. Recommend (book_id)   â†’ Get similar books

ğŸ¯ SCENARIO 2: Chat Conversation
---------------------------------
1. Chat Suggestions      â†’ Get starter prompts
2. Chat "TÃ¬m sÃ¡ch AI"    â†’ Start conversation (saves session_id)
3. Chat "Cuá»‘n nÃ o hay?"  â†’ Continue conversation
4. Get History           â†’ View all messages
5. Clear History         â†’ Reset session

ğŸ¯ SCENARIO 3: Data Management
-------------------------------
1. Trigger Sync (index)  â†’ Re-index data
2. List Jobs             â†’ See all background tasks
3. Get Job Status        â†’ Check specific job
4. Search again          â†’ Test new index

================================================================================
                        TROUBLESHOOTING
================================================================================

âŒ ERROR: Connection Refused
----------------------------
Fix: Start API server
Command: python main.py api

âŒ ERROR: Empty Results []
--------------------------
Fix: Run indexer first
Command: python main.py index

âŒ ERROR: Session Not Found
---------------------------
Fix: Start new chat session first
Body: {"message": "Hello", "top_k": 5}

âŒ ERROR: 500 Internal Server Error
-----------------------------------
Fix: Check API terminal for error logs

================================================================================
                        QUICK REFERENCE
================================================================================

Base URL:     http://localhost:9999
API Prefix:   /ai
Test User:    user@test.com
Password:     password123

Environment Variables:
  base_url    = http://localhost:9999
  session_id  = (auto-saved from chat)

Common Headers:
  Content-Type: application/json

================================================================================
                        SUCCESS CRITERIA
================================================================================

âœ… Health Check     â†’ status: 200, service: "ai_engine"
âœ… Search           â†’ results array with books
âœ… Filters          â†’ categories, years, authors arrays
âœ… Recommend        â†’ recommendations array
âœ… Chat             â†’ session_id + answer + sources
âœ… Suggestions      â†’ suggestions array (5 items)
âœ… History          â†’ messages array
âœ… Sync             â†’ job_id returned
âœ… Jobs             â†’ jobs array

================================================================================
                            THE END
================================================================================

ğŸ“ TIP: Copy-paste bodies vÃ o Postman Ä‘á»ƒ test nhanh!
ğŸš€ Happy Testing!
